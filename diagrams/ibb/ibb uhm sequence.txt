@startuml
autonumber "<font color=red><b>Message 00:"

actor Admin

box "Platform Services"
  participant "Inventory Service" as Netbox
  participant "Automation Service" as Tower
  participant "OS Deployment Service" as LXCA
  participant "Software Repository Service" as Satellite
end box

collections Servers #ff6a00

== PHASE 1: Register resource ==

Netbox -> Tower: apply_workflow(inventory_server_id, workflow_id)
Tower -> Netbox: get_server_bmc_info(inventory_server_id)
Netbox -> Tower: (bmc_ip, bmc_credentials)
Tower -> LXCA: manage(bmc_ip, bmc_credentials)
LXCA -> Tower: `hw_mgt_server_id` if successful; NULL if failed.

== PHASE 2: Apply HW configs ==

Tower -> Netbox: get_server_configs(inventory_server_id)
Netbox -> Tower: `hw_configs`
Tower -> LXCA: config_server(hw_mgt_server_id, hw_configs).
LXCA -> Servers: apply_configs(hw_configs)
LXCA -> Tower: config result `TRUE|FALSE`

== PHASE 3: PROVISION OS ==

Tower -> Netbox: get_server_os(inventory_server_id)
Netbox -> Tower: os_configs
Tower -> LXCA: provision_os(hw_mgt_server_id, os_configs)
LXCA -> Servers: provision_os(hw_mgt_server_id, os_configs)
LXCA -> Tower: provision result `TRUE|FALSE`
Tower -> Netbox: update_server_ssh_info(ip, username, pwd).

== PHASE 4: REGISTER TO SOFTWARE REPO ==

Tower -> Netbox: get_server_repo_key(inventory_server_id)
Netbox -> Tower: repo_service_key_name
Tower -> Satellite: register_server_to_repo(key_name)

@enduml
