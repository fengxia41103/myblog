<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta
      name="viewport"
      content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1"
    />

    <meta name="description" content="" />
    <meta name="author" content="" />

    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"
    />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/monokai-sublime.min.css" integrity="sha512-ade8vHOXH67Cm9z/U2vBpckPD1Enhdxl3N05ChXyFx5xikfqggrK4RrEele+VWY/iaZyfk7Bhk6CyZvlh7+5JQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.1/css/materialize.min.css"
    />

    <link rel="stylesheet" href="https://fengxia41103.github.io/myblog/theme/css/my.css" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"
            integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"></script>



    <title>Be Care Free</title>
  </head>

  <body>
    <header id="mypage-index">
      <a href="https://fengxia41103.github.io/myblog/">Be Care Free </a>

      <a href="https://fengxia41103.github.io/myblog/about.html"> . About </a>
      <a href="https://fengxia41103.github.io/myblog/lei.html"> . 夏雷 </a>
      <a href="https://fengxia41103.github.io/myblog/project euler.html"> . Project Euler </a>
      <a href="https://fengxia41103.github.io/myblog/quote.html"> . Quote </a>
      <a href="https://fengxia41103.github.io/myblog/resume.html"> . Resum&eacute; </a>
      <a href="https://fengxia41103.github.io/myblog/search.html"> . Search </a>
      <a href="https://fengxia41103.github.io/myblog/slides.html"> . Impression </a>
    </header>
    <!-- end of block navbar -->

    <div class="split-screen">
      <div class="split-left-pane">
<!-- <video autoplay muted loop id="myVideo">
     <source src="downloads/polina.mp4" type="video/mp4" />}
     </video>
-->
      </div>

      <div class="split-right-pane">
        <div id="content" class="container">
<article>
   <div>
    <i class="fa fa-calendar" style="opacity: 0.5">&nbsp;</i>
    2018-03-22


    <a class="wave-effect" href="dev.html">
      <i class="fa fa-folder-open-o"></i>
      dev
    </a>

    <a class="wave-effect" href="tag-dev.html">
      <i class="fa fa-tag"></i>
      dev
    </a>

    <h1 class="myhighlight">Django to REST</h1>
  </div>

  <ol id="toc" class="row"></ol>

  <div>
    <div id="article-content">
      <p><figure class="col l6 m6 s12">
  <img src="images/funny/the%20art%20of%20programming.jpg"
       class="center img-responsive">
</figure>

<p>I have been building Django based web application for a while now. One
design/request I get often is a REST API. Once the model data is
exposed in REST, one can truly build a complete separate frontend
using things like Angular, react, and whatever you fancy. I have tried
a couple times myself following this architecture. On one hand it
gives a lot of flexibility and it looks nice, too &larr; front end
technology is a lot of "{}", but it does look quite nice, and
responsive, too. But on the other, REST is a thing few understands
well except it is an API through which you can CRUD. Honestly, I don't
even understand yet how authentication is done, what is a good balance
between massaging data (in Tastypie's term, (de)-hydration) and
exposing data model raw.</p>
<p>Anyway, here I want to document a practice I use, a really rudimentary
one, of making django model available as REST resource through
Tastypie.</p>
<ol>
<li><a href="https://docs.djangoproject.com/en/2.0/ref/models/fields/">Django model reference</a></li>
<li><a href="https://django-tastypie.readthedocs.io/en/latest/">Tastypie</a></li>
</ol>
<p>Let's say you are building a site called <code>mysite</code>, and in it it has an
application called <code>myapp</code>. So the file structure will be like
<code>gitroot/mysite/urls.py</code> for site-level URLs, and
<code>gitroot/myapp/urls.py</code> for app-level patterns. The confusing part is
that <code>myapp/urls.py</code> will be folded into <code>mysite/urls.py</code>. So the
thought is that a site can have multiple applications, each defining
its own <strong>sub-pattern</strong>, while the <code>mysite/urls.py</code> has the first run
of the match before handing URL to <code>myapp/urls.py</code> to match
<strong>further</strong>. So it's a matter of matching order.</p>
<p>Anyway. So building a REST can be broken down into 5 steps:</p>
<figure class="col s12">
  <img src="images/django%20to%20rest.png"
       class="center img-responsive">
</figure>

<p><strong>Step 1</strong>: create an API varialbe name.</p>
<p>Define an object <code>v1_api</code> in <code>myapp/api.py</code>. Name is not important at
all. It is a Tastypie's <a href="https://github.com/django-tastypie/django-tastypie/blob/master/tastypie/api.py"><code>Api</code></a> object, therefore it comes with an army
of capabilities:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">tastypie.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">Api</span>

<span class="n">v1_api</span> <span class="o">=</span> <span class="n">Api</span><span class="p">(</span><span class="n">api_name</span><span class="o">=</span><span class="s1">&#39;v1&#39;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Step 2</strong>: wire URL patterns</p>
<p><code>v1_api</code> defined in the previous step comes with a list of REST url
patterns, and this is the beauty of <a href="https://django-tastypie.readthedocs.io/en/latest/">Tastypie</a>. So all we need to
do is make these <em>sub-patterns</em> available through URL matching. As
explained above, we need to wire these into <code>mysite/urls.py</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">myapp.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">v1_api</span> <span class="k">as</span> <span class="n">myapp_api</span>  <span class="o">&lt;--</span> <span class="n">the</span> <span class="n">variable</span> <span class="n">we</span> <span class="n">defined</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span>
    <span class="c1"># REST</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^mysite/api/myapp/&#39;</span><span class="p">,</span>    <span class="o">&lt;--</span> <span class="n">pattern</span> <span class="n">matching</span>
        <span class="n">include</span><span class="p">(</span><span class="n">myapp_api</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span> <span class="o">&lt;--</span> <span class="n">sub</span><span class="o">-</span><span class="n">pattern</span> <span class="n">handler</span>
</code></pre></div>

<p><strong>Step 3</strong>: define your django DB model</p>
<p>Nothing fancy here. Just the old school of data modeling.</p>
<p><strong>Step 4</strong>: transform DB model to a resource model</p>
<p>REST speaks <em>resources</em>. Packaging a DB model into a resource is quite
simple:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">tastypie.resources</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelResource</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">MyModel</span>  <span class="o">&lt;--</span> <span class="kn">import</span><span class="w"> </span><span class="nn">DB</span> <span class="n">model</span>

<span class="n">v1_api</span> <span class="o">=</span> <span class="n">Api</span><span class="p">(</span><span class="n">api_name</span><span class="o">=</span><span class="s1">&#39;v1&#39;</span><span class="p">)</span> <span class="o">&lt;--</span> <span class="n">we</span> <span class="n">have</span> <span class="n">seen</span> <span class="n">this</span> <span class="n">one</span> <span class="p">(</span><span class="n">see</span> <span class="s2">&quot;step 1&quot;</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MyModelResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">MyModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="o">&lt;--</span> <span class="n">data</span> <span class="nb">set</span> <span class="n">to</span> <span class="n">display</span> <span class="ow">in</span> <span class="nb">list</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s2">&quot;mymodels&quot;</span> <span class="o">&lt;--</span> <span class="n">string</span> <span class="n">used</span> <span class="ow">in</span> <span class="n">REST</span> <span class="n">url</span> <span class="s2">&quot;/mymodels/&quot;</span>
<span class="n">v1_api</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">MyModelResource</span><span class="p">())</span>  <span class="o">&lt;--</span> <span class="n">expose</span> <span class="n">it</span> <span class="n">to</span> <span class="n">URL</span>
</code></pre></div>

<p>This is the simpliest example to make magic happen. What's more you
can do with this now?</p>
<ol>
<li><code>.objects.all()</code>: you don't have to expose everything. Any queryset
   is adequate. REST will allow filtering as well. So just need to be
   aware what your decision means.</li>
<li><a href="http://django-tastypie.readthedocs.io/en/latest/resources.html#flow-through-the-request-response-cycle">de-hydrate</a>: this is how you can massage your data set
   (essentially serializing and de-serializing) before you send data
   to user or taking data from data to DB.</li>
<li>foreign key reverse lookup</li>
</ol>
<p>Django defines reverse lookup by defining a related name in model:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Datacenter</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Cluster</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">datacenter</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;Datacenter&quot;</span><span class="p">,</span>
                                   <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;clusters&quot;</span><span class="p">)</span> <span class="o">&lt;--</span> <span class="n">related_name</span><span class="err">!</span>
</code></pre></div>

<p>Consequently, <code>DataCenterResource</code> reverse lookup to <code>cluster</code> will
be like this:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DatacenterResource</span><span class="p">(</span><span class="n">MyModelResource</span><span class="p">):</span>
  <span class="n">clusters</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ToManyField</span><span class="p">(</span><span class="s2">&quot;vx.api.ClusterResource&quot;</span><span class="p">,</span> <span class="o">&lt;--</span> <span class="n">FK</span> <span class="n">resource</span>
                                <span class="n">attribute</span><span class="o">=</span><span class="s2">&quot;clusters&quot;</span><span class="p">,</span> <span class="o">&lt;--</span> <span class="n">django</span> <span class="n">related</span> <span class="n">name</span>
</code></pre></div>

<p><strong>step 5</strong>: enjoy</p>
<p>Now go to <code>mysite/api/myapp/mymodels</code> (<code>mysite/api/myapp/</code> part is defined
in "step 1", <code>mymodels</code> part is defined in "step 4"), it should show
the <code>queryset</code> (defined in "step 4"). With REST, you can also do
things like <code>?format=json</code> or <code>?format=yaml</code>, and <code>?a_model_field__gt=</code>
type of <a href="http://django-tastypie.readthedocs.io/en/latest/interacting.html">filtering</a>. Cool huh!?</p></p>

      <p>
        &mdash; by
        <a href="feng-xia.html">Feng Xia</a>
      </p>
    </div>
  </div>

</article>



          <div id="related">
          </div>
        </div>
      </div>
    </div>

    <footer class="split-screen">
      <div class="container">
        <h5>Categories:</h5>
        <a href="https://fengxia41103.github.io/myblog/demo.html">
          <i class="fa fa-folder-open-o"></i>
          demo
        </a>
        <a href="https://fengxia41103.github.io/myblog/dev.html">
          <i class="fa fa-folder-open-o"></i>
          dev
        </a>
        <a href="https://fengxia41103.github.io/myblog/fashion.html">
          <i class="fa fa-folder-open-o"></i>
          fashion
        </a>
        <a href="https://fengxia41103.github.io/myblog/gkp.html">
          <i class="fa fa-folder-open-o"></i>
          gkp
        </a>
        <a href="https://fengxia41103.github.io/myblog/lenovo.html">
          <i class="fa fa-folder-open-o"></i>
          lenovo
        </a>
        <a href="https://fengxia41103.github.io/myblog/odoo.html">
          <i class="fa fa-folder-open-o"></i>
          odoo
        </a>
        <a href="https://fengxia41103.github.io/myblog/openstack.html">
          <i class="fa fa-folder-open-o"></i>
          openstack
        </a>
        <a href="https://fengxia41103.github.io/myblog/pm.html">
          <i class="fa fa-folder-open-o"></i>
          pm
        </a>
        <a href="https://fengxia41103.github.io/myblog/react.html">
          <i class="fa fa-folder-open-o"></i>
          REACT
        </a>
        <a href="https://fengxia41103.github.io/myblog/rh.html">
          <i class="fa fa-folder-open-o"></i>
          rh
        </a>
        <a href="https://fengxia41103.github.io/myblog/stock.html">
          <i class="fa fa-folder-open-o"></i>
          stock
        </a>
        <a href="https://fengxia41103.github.io/myblog/thoughts.html">
          <i class="fa fa-folder-open-o"></i>
          thoughts
        </a>

        <h5>Tags:</h5>
        <a href="https://fengxia41103.github.io/myblog/tag-thoughts.html">
          <i class="fa fa-tag"></i>
          thoughts
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-dev.html">
          <i class="fa fa-tag"></i>
          dev
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-react.html">
          <i class="fa fa-tag"></i>
          react
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-love.html">
          <i class="fa fa-tag"></i>
          love
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-lenovo.html">
          <i class="fa fa-tag"></i>
          lenovo
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-angular.html">
          <i class="fa fa-tag"></i>
          angular
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-feng.html">
          <i class="fa fa-tag"></i>
          feng
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-design.html">
          <i class="fa fa-tag"></i>
          design
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-family.html">
          <i class="fa fa-tag"></i>
          family
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-demo.html">
          <i class="fa fa-tag"></i>
          demo
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-odoo.html">
          <i class="fa fa-tag"></i>
          odoo
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-fashion.html">
          <i class="fa fa-tag"></i>
          fashion
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-gkp.html">
          <i class="fa fa-tag"></i>
          gkp
        </a>
        <div class="">
          <h5>Show Cases:</h5>
          <div id="showcase">
            <p>
              Photo album:
              <a href="https://fengxia41103.github.io/moment/1236/#/">1236</a>
            </p>
            <p>
              API & charts:
              <a href="http://sp500chart.s3-website-us-east-1.amazonaws.com"
                >SP500</a
              >
            </p>
            <p>
              API & charts:
              <a
                href="http://snapshots.world.s3-website.ap-northeast-2.amazonaws.com/"
                >Snapshot of The World</a
              >
            </p>

            <p>
              Django (in Chinese):
              <a href="https://fengxia41103.github.io/myblog/project gkp demo.html">GKP</a>
            </p>
            <p>
              ERP:
              <a href="https://fengxia41103.github.io/myblog/project fashion demo.html">Fashion</a>
            </p>
            <p>
              Data processing:
              <a href="https://fengxia41103.github.io/myblog/project stock demo.html">Stock</a>
            </p>
            <p>
              Angular & REACT:
              <a href="https://fengxia41103.github.io/myblog/car leasing.html">Car leasing</a>
              &nbsp;|&nbsp;
              <a href="https://fengxia41103.github.io/spa-dashboard/">
                YAML Config Dashboard
              </a>
            </p>
            <p>
              API & REACT:
              <a href="https://fengxia41103.github.io/movie/">Movies</a>
            </p>
          </div>
        </div>
      </div>
      <video autoplay muted loop id="myVideo">
        <source src="downloads/polina.mp4" type="video/mp4" />
      </video>
    </footer>
    <div class="footer-copyright">
      <div class="container">
        <div class="row">
          <div class="col l8 m8 s12">
            <p>
              2016-2022 PY Consulting Ltd. 601 W. Rosemary St., Chapel Hill, NC 27516
            </p>

            <p>
              <a href="mailto:feng_xia41103@hotmail.com">
                <i class="fa fa-envelope"></i>
              </a>

              <a href="http://github.com/fengxia41103">
                <i class="fa fa-github"></i>
              </a>

              <a href="https://www.linkedin.com/in/fengxia41103">
                <i class="fa fa-linkedin"></i>
              </a>

              <a href="">
                <i class="fa fa-phone-square"></i>
                (508)801-1794
              </a>
            </p>
          </div>
          <div class="col l4 m4 s12">
            <p class="right">
              <i class="fa fa-copyright"></i>
              All rights reserved.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- end of block main -->

    <!-- Placed at the end of the document so the pages load faster -->

    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.1/js/materialize.min.js"
    ></script>

    <script
      type="text/javascript"
      src="https://fengxia41103.github.io/myblog/theme/js/bundle.js"
    ></script>

    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/shell.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"
    ></script>

    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/lisp.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/javascript.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/xml.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/diff.min.js"
    ></script>

    <script type="text/javascript">
     var exports = {};
     var j$ = jQuery.noConflict();

     j$(document).ready(function () {
       // highlight.js initialization
       hljs.initHighlightingOnLoad();
       j$("pre").each(function (i, block) {
         hljs.highlightBlock(block);
       });

       // tooltips
       j$('[data-toggle="tooltip"]').tooltip();

       // image materialbox
       j$(".materialboxed").materialbox();
     });
    </script>
    <!-- end of block JS -->

  </body>
</html>