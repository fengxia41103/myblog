<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta
      name="viewport"
      content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1"
    />

    <meta name="description" content="" />
    <meta name="author" content="" />

    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"
    />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/monokai-sublime.min.css" integrity="sha512-ade8vHOXH67Cm9z/U2vBpckPD1Enhdxl3N05ChXyFx5xikfqggrK4RrEele+VWY/iaZyfk7Bhk6CyZvlh7+5JQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.1/css/materialize.min.css"
    />

    <link rel="stylesheet" href="https://fengxia41103.github.io/myblog/theme/css/my.css" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"
            integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"></script>



    <title>Be Care Free</title>
  </head>

  <body>
    <header id="mypage-index">
      <a href="https://fengxia41103.github.io/myblog/">Be Care Free </a>

      <a href="https://fengxia41103.github.io/myblog/about.html"> . About </a>
      <a href="https://fengxia41103.github.io/myblog/lei.html"> . 夏雷 </a>
      <a href="https://fengxia41103.github.io/myblog/project euler.html"> . Project Euler </a>
      <a href="https://fengxia41103.github.io/myblog/quote.html"> . Quote </a>
      <a href="https://fengxia41103.github.io/myblog/resume.html"> . Resum&eacute; </a>
      <a href="https://fengxia41103.github.io/myblog/search.html"> . Search </a>
      <a href="https://fengxia41103.github.io/myblog/slides.html"> . Impression </a>
    </header>
    <!-- end of block navbar -->

    <div class="split-screen">
      <div class="split-left-pane">
<!-- <video autoplay muted loop id="myVideo">
     <source src="downloads/polina.mp4" type="video/mp4" />}
     </video>
-->
      </div>

      <div class="split-right-pane">
        <div id="content" class="container">
<article>
   <div>
    <i class="fa fa-calendar" style="opacity: 0.5">&nbsp;</i>
    2017-07-06


    <a class="wave-effect" href="openstack.html">
      <i class="fa fa-folder-open-o"></i>
      openstack
    </a>

    <a class="wave-effect" href="tag-lenovo.html">
      <i class="fa fa-tag"></i>
      lenovo
    </a>

    <h1 class="myhighlight">Charm Ansible integration</h1>
  </div>

  <ol id="toc" class="row"></ol>

  <div>
    <div id="article-content">
      <blockquote>
        <span class="myhighlight">Copyright @ Lenovo US</span>
      </blockquote>
      <p><p>Let's face it. Ansible has the mouth (and market) share these
days. For our modeling purpose, we are to utilize its procedural
strength to carry out actions, which provides an abstraction instead
of coding in charm's Python files.</p>
<p>Design objectives:</p>
<ol>
<li>Design as reusable <a href="https://jujucharms.com/docs/2.1/developer-layers">layer(s)</a></li>
<li>Be compatible with Ubuntu and CentOS</li>
<li>Simple pattern to execute a playbook</li>
</ol>
<p>Assumption:</p>
<ol>
<li>Playbooks will be local (in charm) so to maintain the
   atomic nature of a HW charm &mdash; the model contains both the
   declaration of attributes and actions to handle runtime state transitions.</li>
</ol>
<h1>Method 1: layer-ansible</h1>
<p>Method 1 is to use an existing project, <a href="https://github.com/chuckbutler/charms.ansible">layer-ansible</a>.</p>
<p>Examine its code reveals a typical pattern one would use to introduce
a new function:</p>
<ol>
<li>
<p>Install Ansible. The approach it took is to use a
   <code>ppa:ansible/ansible</code> source and installed by calling
   <code>charmhelpers.fetch.apt_install</code>. The key issue here is using <code>ppa</code>
   which is an <strong>hardcoded</strong> Ubuntu approach.</p>
<div class="highlight"><pre><span></span><code>```python
def install_ansible_support(from_ppa=True, ppa_location=&#39;ppa:ansible/ansible&#39;):
  if from_ppa:
      charmhelpers.fetch.add_source(ppa_location)
      charmhelpers.fetch.apt_update(fatal=True)
  charmhelpers.fetch.apt_install(&#39;ansible&#39;)
  with open(ansible_hosts_path, &#39;w+&#39;) as hosts_file:
      hosts_file.write(&#39;localhost ansible_connection=local&#39;)
```
</code></pre></div>

</li>
<li>
<p>Helper function to execute. Clearly the approach here is to use
   <code>subprocess.check_call</code> which is calling <code>ansible-playbook</code> as
   CLI. This works fine but then think about all the CLI switches that
   <code>ansible-playbook</code> can take which in turn need to be exposed
   through this function &larr; currently it supports <code>tags</code> and <code>extra-vars</code>.</p>
<div class="highlight"><pre><span></span><code><span class="err">```</span><span class="n">python</span>
<span class="n">def</span><span class="w"> </span><span class="n">apply_playbook</span><span class="p">(</span><span class="n">playbook</span><span class="p">,</span><span class="w"> </span><span class="n">tags</span><span class="o">=</span><span class="n">None</span><span class="p">,</span><span class="w"> </span><span class="n">extra_vars</span><span class="o">=</span><span class="n">None</span><span class="p">):</span>
<span class="w">    </span><span class="o">....</span>
<span class="w">    </span><span class="n">call</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s1">&#39;ansible-playbook&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;-c&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;local&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="n">playbook</span><span class="p">,</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">tags</span><span class="p">:</span>
<span class="w">        </span><span class="n">call</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;--tags&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tags</span><span class="p">)])</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">extra_vars</span><span class="p">:</span>
<span class="w">        </span><span class="n">extra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">extra_vars</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
<span class="w">        </span><span class="n">call</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;--extra-vars&#39;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extra</span><span class="p">)])</span>
<span class="w">    </span><span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="n">call</span><span class="p">,</span><span class="w"> </span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>
<span class="err">```</span>
</code></pre></div>

</li>
</ol>
<p>A nice feature of this library is the implementation of <a href="https://jujucharms.com/docs/stable/authors-charm-hooks">hooks</a> and
<a href="https://jujucharms.com/docs/stable/actions">actions</a> so that Ansible can answer to <code>hook</code> event and can be
executed as <code>action</code>.</p>
<h1>Method 2: layer-myansible</h1>
<p>This method is inspired by <a href="https://serversforhackers.com/running-ansible-2-programmatically">this article</a>. This is to take
advantage of the <a href="http://docs.ansible.com/ansible/dev_guide/developing_api.html">Ansible Python API</a>. </p>
<ol>
<li>
<p>Install prerequisites. Installing <code>Ansible</code> will fail on a vanilla
   Ubuntu because it misses a few dependencies. Using <a href="https://github.com/juju-solutions/layer-basic">layer-basic</a>
   by listing them out in <code>layer.yaml</code>:</p>
<p><code>yaml
    includes:
      - 'layer:basic'
    options:
      basic:
        packages:
          - libffi-dev
          - libssl-dev
          - python
          - python3-dev</code></p>
</li>
<li>
<p>Install Ansible.  Use Python <a href="https://packaging.python.org/discussions/wheel-vs-egg/?highlight=wheel">wheel</a> supported
   by <a href="https://github.com/juju-solutions/layer-basic">layer-basic</a>. In <code>wheelhouse.txt</code>:</p>
<div class="highlight"><pre><span></span><code>```shell
ansible==2.2.0
```
</code></pre></div>

</li>
<li>
<p><code>ansible.cfg</code>. Instead of using a global config, this is local so
   each charm can have its own variation if desired.</p>
<div class="highlight"><pre><span></span><code><span class="err">```</span><span class="n">shell</span>
<span class="o">[</span><span class="n">defaults</span><span class="o">]</span>
<span class="n">inventory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">hosts</span>
<span class="n">log_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">/</span><span class="nf">var</span><span class="o">/</span><span class="nf">log</span><span class="o">/</span><span class="n">ansible</span><span class="o">/</span><span class="n">ansible</span><span class="p">.</span><span class="nf">log</span>
<span class="n">remote_tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">HOME</span><span class="o">/</span><span class="p">.</span><span class="n">ansible</span><span class="o">/</span><span class="n">tmp</span>
<span class="n">local_tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="n">HOME</span><span class="o">/</span><span class="p">.</span><span class="n">ansible</span><span class="o">/</span><span class="n">tmp</span>
<span class="o">[</span><span class="n">ssh_connection</span><span class="o">]</span>
<span class="n">ssh_args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">UserKnownHostsFile</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="k">null</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">StrictHostKeyChecking</span><span class="o">=</span><span class="k">no</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">IdentitiesOnly</span><span class="o">=</span><span class="n">yes</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">ControlMaster</span><span class="o">=</span><span class="n">auto</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">ControlPersist</span><span class="o">=</span><span class="mi">60</span><span class="n">s</span>
<span class="n">control_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~/</span><span class="p">.</span><span class="n">ansible</span><span class="o">/</span><span class="n">cp</span><span class="o">/</span><span class="n">ansible</span><span class="o">-</span><span class="n">ssh</span><span class="o">-%%</span><span class="n">h</span><span class="o">-%%</span><span class="n">p</span><span class="o">-%%</span><span class="n">r</span>
<span class="err">```</span>
</code></pre></div>

</li>
<li>
<p>Options. Constructed a class to be the abstraction of Ansible
   options:</p>
<div class="highlight"><pre><span></span><code><span class="err">```</span><span class="n">python</span>
<span class="k">class</span><span class="w"> </span><span class="n">Options</span><span class="p">(</span><span class="n">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Options class to replace Ansible OptParser</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="w">    </span><span class="o">....</span>
<span class="w">    </span><span class="n">verbosity</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">inventory</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">listhosts</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">subset</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">module_paths</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">extra_vars</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">forks</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">ask_vault_pass</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">vault_password_files</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">new_vault_password_file</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">output_file</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">tags</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">skip_tags</span><span class="o">=</span><span class="p">[],</span>
<span class="w">    </span><span class="n">one_line</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">tree</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">ask_sudo_pass</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">ask_su_pass</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">sudo</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">sudo_user</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">become</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">become_method</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">become_user</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">become_ask_pass</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">ask_pass</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">private_key_file</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">remote_user</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">connection</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">timeout</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">ssh_common_args</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">sftp_extra_args</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">scp_extra_args</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">ssh_extra_args</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">poll_interval</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">seconds</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">check</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">syntax</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">diff</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">force_handlers</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">flush_cache</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">listtasks</span><span class="o">=</span><span class="n">None</span><span class="p">,</span>
<span class="w">    </span><span class="n">listtags</span><span class="o">=</span><span class="p">[],</span>
<span class="w">    </span><span class="n">module_path</span><span class="o">=</span><span class="n">None</span>
<span class="err">```</span>
</code></pre></div>

</li>
<li>
<p>Playbook execution. Running it is to use
   Ansible's API call <code>PlaybookExecutor</code>.</p>
<div class="highlight"><pre><span></span><code><span class="err">```</span><span class="n">python</span>
<span class="bp">self</span><span class="o">.</span><span class="n">pbex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">playbook_executor</span><span class="o">.</span><span class="n">PlaybookExecutor</span><span class="p">(</span>
<span class="w">    </span><span class="n">playbooks</span><span class="o">=</span><span class="n">pbs</span><span class="p">,</span>
<span class="w">    </span><span class="n">inventory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inventory</span><span class="p">,</span>
<span class="w">    </span><span class="n">variable_manager</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">variable_manager</span><span class="p">,</span>
<span class="w">    </span><span class="n">loader</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="p">,</span>
<span class="w">    </span><span class="n">options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">,</span>
<span class="w">    </span><span class="n">passwords</span><span class="o">=</span><span class="n">passwords</span><span class="p">)</span>
<span class="o">....</span>
<span class="bp">self</span><span class="o">.</span><span class="n">pbex</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="err">```</span>
</code></pre></div>

</li>
</ol>
<h1>Charm integration</h1>
<p>Using <code>layer-myansible</code> for example, integrating with charm takes the
followings:</p>
<ol>
<li>
<p>Include layer. In <code>layer.yaml</code>:</p>
<div class="highlight"><pre><span></span><code>```yaml
includes:
  - &#39;layer:basic&#39;
  - &#39;layer:myansible&#39;
```
</code></pre></div>

</li>
<li>
<p>Create a <code>playbooks</code> folder and place playbooks here:</p>
<div class="highlight"><pre><span></span><code>```shell
.
├── config.yaml
├── icon.svg
├── layer.yaml
├── metadata.yaml
├── playbooks
│   └── test.yaml
└── reactive
    └── solution.py
```
</code></pre></div>

</li>
<li>
<p>Using <code>config.yaml</code> to pass in playbook for each action that is
   defined in the charm states. For example, define <code>test.yaml</code> for an
   action in <code>state-0</code>:</p>
<div class="highlight"><pre><span></span><code><span class="err">```</span><span class="nx">yaml</span>
<span class="nx">options</span><span class="p">:</span>
<span class="w">  </span><span class="nx">state</span><span class="o">-</span><span class="mi">0</span><span class="o">-</span><span class="nx">playbook</span><span class="p">:</span>
<span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="k">default</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;test.yaml&quot;</span>
<span class="w">    </span><span class="nx">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Playbook for...&quot;</span>
<span class="err">```</span>
</code></pre></div>

</li>
<li>
<p>Define the playbook. For example, a <em>hello world</em> that will create
   a file `/tmp/testfile.txt'.</p>
<div class="highlight"><pre><span></span><code>```yaml
-<span class="w"> </span>name:<span class="w"> </span>This<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>hello-world<span class="w"> </span>example
<span class="w">  </span>hosts:<span class="w"> </span>127.0.0.1
<span class="w">  </span>tasks:
<span class="w">  </span>-<span class="w"> </span>name:<span class="w"> </span>Create<span class="w"> </span>a<span class="w"> </span>file<span class="w"> </span>called<span class="w"> </span>&#39;/tmp/testfile.txt&#39;<span class="w"> </span>with<span class="w"> </span>the<span class="w"> </span>content<span class="w"> </span>&#39;hello<span class="w"> </span>world&#39;.
<span class="w">    </span>copy:<span class="w"> </span>content=&quot;hello<span class="w"> </span>world\n&quot;<span class="w"> </span>dest=/tmp/testfile.txt
<span class="w">    </span>tags:
<span class="w">      </span>-<span class="w"> </span>sth
```
</code></pre></div>

<p>Note that <code>tags</code> value <code>sth</code> must match playbook run call (see
below).</p>
</li>
<li>
<p>In charm <code>.py</code> file, <code>from charms.layer.task import Runner</code>, then
   in <code>state-0</code> to call given playbook:</p>
<div class="highlight"><pre><span></span><code><span class="err">```</span><span class="n">python</span>
<span class="n">playbook</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">config</span><span class="o">[</span><span class="n">&#39;state-0-playbook&#39;</span><span class="o">]</span>
<span class="n">runner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Runner</span><span class="p">(</span>
<span class="w">    </span><span class="n">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;sth&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="o">&lt;</span><span class="c1">-- must match the tag in the playbook</span>
<span class="w">    </span><span class="k">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;local&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="o">&lt;</span><span class="c1">-- must be &quot;local&quot;</span>
<span class="w">    </span><span class="n">hostnames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="o">&lt;</span><span class="c1">-- assuming execution in localhost</span>
<span class="w">    </span><span class="n">playbooks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">playbook</span><span class="o">]</span><span class="p">,</span>
<span class="w">    </span><span class="n">private_key_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">run_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{}</span><span class="p">,</span>
<span class="w">    </span><span class="n">become_pass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">verbosity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="p">)</span>
<span class="n">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">runner</span><span class="p">.</span><span class="n">run</span><span class="p">()</span>
<span class="err">```</span>
</code></pre></div>

</li>
</ol>
<p>That's it. Now you can build a charm by including <code>layer-myansible</code>
and run any playbooks in your charm by following this design pattern
while taking full advantage of the <a href="http://docs.ansible.com/ansible/dev_guide/developing_api.html">Ansible Python API</a>. Beautiful.</p></p>

      <p>
        &mdash; by
        <a href="feng-xia.html">Feng Xia</a>
      </p>
    </div>
  </div>

</article>



          <div id="related">
          </div>
        </div>
      </div>
    </div>

    <footer class="split-screen">
      <div class="container">
        <h5>Categories:</h5>
        <a href="https://fengxia41103.github.io/myblog/demo.html">
          <i class="fa fa-folder-open-o"></i>
          demo
        </a>
        <a href="https://fengxia41103.github.io/myblog/dev.html">
          <i class="fa fa-folder-open-o"></i>
          dev
        </a>
        <a href="https://fengxia41103.github.io/myblog/fashion.html">
          <i class="fa fa-folder-open-o"></i>
          fashion
        </a>
        <a href="https://fengxia41103.github.io/myblog/gkp.html">
          <i class="fa fa-folder-open-o"></i>
          gkp
        </a>
        <a href="https://fengxia41103.github.io/myblog/lenovo.html">
          <i class="fa fa-folder-open-o"></i>
          lenovo
        </a>
        <a href="https://fengxia41103.github.io/myblog/odoo.html">
          <i class="fa fa-folder-open-o"></i>
          odoo
        </a>
        <a href="https://fengxia41103.github.io/myblog/openstack.html">
          <i class="fa fa-folder-open-o"></i>
          openstack
        </a>
        <a href="https://fengxia41103.github.io/myblog/pm.html">
          <i class="fa fa-folder-open-o"></i>
          pm
        </a>
        <a href="https://fengxia41103.github.io/myblog/react.html">
          <i class="fa fa-folder-open-o"></i>
          REACT
        </a>
        <a href="https://fengxia41103.github.io/myblog/rh.html">
          <i class="fa fa-folder-open-o"></i>
          rh
        </a>
        <a href="https://fengxia41103.github.io/myblog/stock.html">
          <i class="fa fa-folder-open-o"></i>
          stock
        </a>
        <a href="https://fengxia41103.github.io/myblog/thoughts.html">
          <i class="fa fa-folder-open-o"></i>
          thoughts
        </a>

        <h5>Tags:</h5>
        <a href="https://fengxia41103.github.io/myblog/tag-thoughts.html">
          <i class="fa fa-tag"></i>
          thoughts
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-dev.html">
          <i class="fa fa-tag"></i>
          dev
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-react.html">
          <i class="fa fa-tag"></i>
          react
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-love.html">
          <i class="fa fa-tag"></i>
          love
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-lenovo.html">
          <i class="fa fa-tag"></i>
          lenovo
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-angular.html">
          <i class="fa fa-tag"></i>
          angular
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-feng.html">
          <i class="fa fa-tag"></i>
          feng
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-design.html">
          <i class="fa fa-tag"></i>
          design
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-family.html">
          <i class="fa fa-tag"></i>
          family
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-demo.html">
          <i class="fa fa-tag"></i>
          demo
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-odoo.html">
          <i class="fa fa-tag"></i>
          odoo
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-fashion.html">
          <i class="fa fa-tag"></i>
          fashion
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-gkp.html">
          <i class="fa fa-tag"></i>
          gkp
        </a>
        <div class="">
          <h5>Show Cases:</h5>
          <div id="showcase">
            <p>
              Photo album:
              <a href="https://fengxia41103.github.io/moment/1236/#/">1236</a>
            </p>
            <p>
              API & charts:
              <a href="http://sp500chart.s3-website-us-east-1.amazonaws.com"
                >SP500</a
              >
            </p>
            <p>
              API & charts:
              <a
                href="http://snapshots.world.s3-website.ap-northeast-2.amazonaws.com/"
                >Snapshot of The World</a
              >
            </p>

            <p>
              Django (in Chinese):
              <a href="https://fengxia41103.github.io/myblog/project gkp demo.html">GKP</a>
            </p>
            <p>
              ERP:
              <a href="https://fengxia41103.github.io/myblog/project fashion demo.html">Fashion</a>
            </p>
            <p>
              Data processing:
              <a href="https://fengxia41103.github.io/myblog/project stock demo.html">Stock</a>
            </p>
            <p>
              Angular & REACT:
              <a href="https://fengxia41103.github.io/myblog/car leasing.html">Car leasing</a>
              &nbsp;|&nbsp;
              <a href="https://fengxia41103.github.io/spa-dashboard/">
                YAML Config Dashboard
              </a>
            </p>
            <p>
              API & REACT:
              <a href="https://fengxia41103.github.io/movie/">Movies</a>
            </p>
          </div>
        </div>
      </div>
      <video autoplay muted loop id="myVideo">
        <source src="downloads/polina.mp4" type="video/mp4" />
      </video>
    </footer>
    <div class="footer-copyright">
      <div class="container">
        <div class="row">
          <div class="col l8 m8 s12">
            <p>
              2016-2022 PY Consulting Ltd. 601 W. Rosemary St., Chapel Hill, NC 27516
            </p>

            <p>
              <a href="mailto:feng_xia41103@hotmail.com">
                <i class="fa fa-envelope"></i>
              </a>

              <a href="http://github.com/fengxia41103">
                <i class="fa fa-github"></i>
              </a>

              <a href="https://www.linkedin.com/in/fengxia41103">
                <i class="fa fa-linkedin"></i>
              </a>

              <a href="">
                <i class="fa fa-phone-square"></i>
                (508)801-1794
              </a>
            </p>
          </div>
          <div class="col l4 m4 s12">
            <p class="right">
              <i class="fa fa-copyright"></i>
              All rights reserved.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- end of block main -->

    <!-- Placed at the end of the document so the pages load faster -->

    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.1/js/materialize.min.js"
    ></script>

    <script
      type="text/javascript"
      src="https://fengxia41103.github.io/myblog/theme/js/bundle.js"
    ></script>

    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/shell.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"
    ></script>

    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/lisp.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/javascript.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/xml.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/diff.min.js"
    ></script>

    <script type="text/javascript">
     var exports = {};
     var j$ = jQuery.noConflict();

     j$(document).ready(function () {
       // highlight.js initialization
       hljs.initHighlightingOnLoad();
       j$("pre").each(function (i, block) {
         hljs.highlightBlock(block);
       });

       // tooltips
       j$('[data-toggle="tooltip"]').tooltip();

       // image materialbox
       j$(".materialboxed").materialbox();
     });
    </script>
    <!-- end of block JS -->

  </body>
</html>