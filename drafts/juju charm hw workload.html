<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta
      name="viewport"
      content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1"
    />

    <meta name="description" content="" />
    <meta name="author" content="" />

    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"
    />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/monokai-sublime.min.css" integrity="sha512-ade8vHOXH67Cm9z/U2vBpckPD1Enhdxl3N05ChXyFx5xikfqggrK4RrEele+VWY/iaZyfk7Bhk6CyZvlh7+5JQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.1/css/materialize.min.css"
    />

    <link rel="stylesheet" href="https://fengxia41103.github.io/myblog/theme/css/my.css" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"
            integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"></script>



    <title>Be Care Free</title>
  </head>

  <body>
    <header id="mypage-index">
      <a href="https://fengxia41103.github.io/myblog/">Be Care Free </a>

      <a href="https://fengxia41103.github.io/myblog/about.html"> . About </a>
      <a href="https://fengxia41103.github.io/myblog/lei.html"> . 夏雷 </a>
      <a href="https://fengxia41103.github.io/myblog/project euler.html"> . Project Euler </a>
      <a href="https://fengxia41103.github.io/myblog/quote.html"> . Quote </a>
      <a href="https://fengxia41103.github.io/myblog/resume.html"> . Resum&eacute; </a>
      <a href="https://fengxia41103.github.io/myblog/search.html"> . Search </a>
      <a href="https://fengxia41103.github.io/myblog/slides.html"> . Impression </a>
    </header>
    <!-- end of block navbar -->

    <div class="split-screen">
      <div class="split-left-pane">
<!-- <video autoplay muted loop id="myVideo">
     <source src="downloads/polina.mp4" type="video/mp4" />}
     </video>
-->
      </div>

      <div class="split-right-pane">
        <div id="content" class="container">
<article>
   <div>
    <i class="fa fa-calendar" style="opacity: 0.5">&nbsp;</i>
    2017-04-25


    <a class="wave-effect" href="openstack.html">
      <i class="fa fa-folder-open-o"></i>
      openstack
    </a>

    <a class="wave-effect" href="tag-lenovo.html">
      <i class="fa fa-tag"></i>
      lenovo
    </a>

    <h1 class="myhighlight">HW workload charms</h1>
  </div>

  <ol id="toc" class="row"></ol>

  <div>
    <div id="article-content">
      <blockquote>
        <span class="myhighlight">Copyright @ Lenovo US</span>
      </blockquote>
      <p><p>In this article we will introduce the HW workload charms and how to
build them. <strong>What is a HW workload?</strong> In orchestration space we can
divide technologies into two categories: description language and
orchestration runtime. Description language defines a particular set
of syntax, keywords and format that one uses to <strong>describe</strong> a
workload, and runtime is the binaries that consumes the template (or
blueprints) and execute instructions. With this context, we can view
charms as the workload template in which one uses <em>states</em> that a
workload should observe, and Juju binaries, including its CLI and juju
agent, provide the runtime environment to monitor and act upon those
states.</p>
<p>So far charms have been used to describe software workload both in the
level of software application (eg. MySql) and the level of platform
(eg. Openstack). The underline assumption is that a supporting layer
pre-exist, such as an operating system or a platform (thinking of
Openstack or hypervisors). Extending on this concept, we ask ourselves
whether we can utilize the same Juju &amp; Charm framework to support
deployment of infrastructures? If assuming the infrastructure can be
<strong>software-defined</strong>, once the wires are all done and
hardwares are installed, what's left to do is really falling into the
same pattern as deploying a software application -- installing OS,
installing application, tweak configurations and so on.</p>
<p>Along this thought, using ThinkAgile as an example we set off to model
a <strong>Hardware workload</strong> in charms.</p>
<figure class="s12 center">
  <img src="images/hw%20workload%20stack%20diff.png" />
  <figcaption>New system stack with HW workload capability</figcaption>
</figure>

<h1>Vision</h1>
<blockquote>
<p>Utilizing charm technology and its toolsets to model a hardware
<strong>solution</strong> and components and to a achieve a seamless deployment
from design board and a configured system with full automation. </p>
</blockquote>
<p>As an example, we are to design a solution that consists of the
following hardwares. Using the charm tools we will be not only model
the solution, but to make the deployment based on this configuration
so to acquire a complete software-defined system.</p>
<figure class="row">
  <img class="col s7"
       src="images/hw%20workload%20deploy%20example.png" />
  <img class="col s5"
       src="images/hw%20workload%20deploy%20example%20components.png" />
  <figcaption class="col s12">HW workloads</figcaption>
</figure>

<h1>Model</h1>
<p>In an over simplified form, we view a system such as ThinkAgile in a tree
model, where the top level is a <strong>solution</strong>, say ThinkAgile, which
then contains one-to-many racks. Rack can then include servers, and
servers are consisted of components such as RAID adapters and
storages.</p>
<figure class="s12 center">
  <img src="images/hw%20solution%20tree.png" />
  <figcaption>HW solution hierarchy</figcaption>
</figure>

<p>Each of these entities (rack, server, and so on) can have
configuration options (attributes), and to execute these
configurations there will be actions. So if we arrive to the point
that we define a switch with its attributes and a set of actions so
that it can be configured based on a pre-defined blueprint, we shall
be able to wire these entities together to achieve higher complexity
&mdash; like building legos!</p>
<h1>Charm dev</h1>
<p>In this section we'll go over the code layout that implement this
model in charm terms. </p>
<h2>Code layout</h2>
<p>The code can really live in any folder (we can wire them using
environment variables, see below). But here we suggest to put all of
them into one directory.</p>
<ol>
<li><span class="myhighlight">interfaces</span>: relation interface
   code. This is the mechanism to signal between charms and between
   charm units since <code>state</code> do not go across unit boundary.</li>
<li><span class="myhighlight">charms</span>: charm code. Each subfolder can
   be compiled into a charm (see "Compiling charms" section for
   details).</li>
<li><span class="dist">dist</span>: built charms live here. Subfolder
   <code>trusty</code> is defined in charm build <code>--series</code>. This is significant
   in software application where one determines the OS compatibility
   with the deployment, but has no meaning in HW workload currently. </li>
</ol>
<div class="highlight"><pre><span></span><code>.
├──<span class="w"> </span>deps
│<span class="w">   </span>├──<span class="w"> </span>interface
│<span class="w">   </span>└──<span class="w"> </span>layer
├──<span class="w"> </span>dist
│<span class="w">   </span>├──<span class="w"> </span>deps
│<span class="w">   </span>└──<span class="w"> </span>trusty
├──<span class="w"> </span>interfaces
│<span class="w">   </span>├──<span class="w"> </span>rack-pdu
│<span class="w">   </span>├──<span class="w"> </span>rack-switch
│<span class="w">   </span>├──<span class="w"> </span>raid-server
│<span class="w">   </span>├──<span class="w"> </span>server-rack
│<span class="w">   </span>├──<span class="w"> </span>storage-server
│<span class="w">   </span>└──<span class="w"> </span>switch-server
├──<span class="w"> </span>charms
│<span class="w">   </span>├──<span class="w"> </span>charm-chain-state
│<span class="w">   </span>├──<span class="w"> </span>charm-pdu
│<span class="w">   </span>├──<span class="w"> </span>charm-rack
│<span class="w">   </span>├──<span class="w"> </span>charm-raid
│<span class="w">   </span>├──<span class="w"> </span>charm-raid-cisco-p345
│<span class="w">   </span>├──<span class="w"> </span>charm-raid-dell-h330
│<span class="w">   </span>├──<span class="w"> </span>charm-server
│<span class="w">   </span>├──<span class="w"> </span>charm-server-3550
│<span class="w">   </span>├──<span class="w"> </span>charm-server-3650
│<span class="w">   </span>├──<span class="w"> </span>charm-storage
│<span class="w">   </span>├──<span class="w"> </span>charm-switch
│<span class="w">   </span>├──<span class="w"> </span>charm-switch-dell-n2048p
│<span class="w">   </span>└──<span class="w"> </span>charm-switch-meraki-ms425
├──<span class="w"> </span>README.md
└──<span class="w"> </span>thinkagile.yaml
</code></pre></div>

<h2>Environment variables</h2>
<p>Correspondingly, we define three environment variables, each points to
a folder above:</p>
<ol>
<li><code>LAYER_PATH</code> &rarr; <code>./charms</code>, where charm/layer code resides.</li>
<li><code>INTERFACE_PATH</code> &rarr; <code>./interfaces</code>, where interface code
   resides.</li>
<li><code>JUJU_REPOSITORY</code> &rarr; <code>./dist</code>, where ready-to-deploy charms reside.</li>
</ol>
<h2>Compiling charms</h2>
<p>Compiling a charm refers to using a Canonical developed Python tool,
<code>charm-tools</code>(<a href="https://jujucharms.com/docs/1.24/authors-charm-metadata">source</a>), to assemble charm and its dependent libs
and so on into a single <em>charm</em> so that juju can then be used to
deploy it to a target machine.</p>
<p>Two ways to install <code>charm-tools</code>:
1. <code>apt get charm-tools</code> (if on Ubuntu), or
2. <code>pip install charm-tools</code>, preferred since then you can use Python
   virtualenv.</p>
<p>Be warned that the installed <code>charm</code> has a poor CLI interface &mdash;
it doesn't have <code>--help</code> nor error message if the parameters are not
adequate. So typing <code>$ charm</code> will hang without giving you a clue of
what is going wrong.</p>
<p>To compile a charm, for exampe <code>charm-switch</code>:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$LAYER_PATH</span>/charm-server
$<span class="w"> </span>charm<span class="w"> </span>build
....
build:<span class="w"> </span>Composing<span class="w"> </span>into<span class="w"> </span>/home/fengxia/workspace/hwcharm/dist
build:<span class="w"> </span>Destination<span class="w"> </span>charm<span class="w"> </span>directory:<span class="w"> </span>/home/fengxia/workspace/hwcharm/dist/trusty/switch
build:<span class="w"> </span>Processing<span class="w"> </span>layer:<span class="w"> </span>layer:basic
build:<span class="w"> </span>Processing<span class="w"> </span>layer:<span class="w"> </span>switch
</code></pre></div>

<p>The <code>Destination charm directory</code> is the directory defined by
environment variable <code>JUJU_REPOSITORY</code>.</p>
<h1>A HW charm</h1>
<p>Defining a HW charm is like defining any other charms. The basic code
structure is shown below (using <code>charm-switch</code> as an example):</p>
<div class="highlight"><pre><span></span><code>.
├──<span class="w"> </span>config.yaml<span class="w">        </span>&lt;--<span class="w"> </span>configuration<span class="w"> </span>options
├──<span class="w"> </span>icon.svg<span class="w">           </span>&lt;--<span class="w"> </span>application<span class="w"> </span>icon
├──<span class="w"> </span>layer.yaml<span class="w">         </span>&lt;--<span class="w"> </span>charm<span class="w"> </span>inheritance
├──<span class="w"> </span>metadata.yaml<span class="w">      </span>&lt;--<span class="w"> </span>charm<span class="w"> </span>name,<span class="w"> </span>relations
├──<span class="w"> </span>reactive<span class="w">          </span>
│<span class="w">   </span>└──<span class="w"> </span>switch.py<span class="w">      </span>&lt;--<span class="w"> </span>application<span class="w"> </span>logics
└──<span class="w"> </span>templates
<span class="w">    </span>└──<span class="w"> </span>switch_config<span class="w">  </span>&lt;--<span class="w"> </span>jinja2<span class="w"> </span>template<span class="w"> </span><span class="k">for</span><span class="w"> </span>configs
</code></pre></div>

<h2>config.yaml</h2>
<p>The file holds configuration variables that can then be set using juju
command and through Juju GUI. For example, here we define a few switch
attributes: <code>size</code>, <code>speed</code>, <code>os</code>, <code>cooling-orientation</code>... Charm
supports four <code>type</code>: boolean, string, int and float.</p>
<div class="highlight"><pre><span></span><code><span class="nt">options</span><span class="p">:</span>
<span class="w">  </span><span class="nt">size</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">    </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1U&quot;</span>
<span class="w">    </span><span class="nt">descriptioin</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1U/2U&quot;</span>
<span class="w">  </span><span class="nt">speed</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">    </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1G&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1G/10G&quot;</span>
<span class="w">  </span><span class="nt">cooling-orientation</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">    </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Horizontal&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Horizontal/Vertical&quot;</span>
<span class="w">  </span><span class="nt">os</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">    </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ENOS&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ENOS/CNOS&quot;</span>
<span class="w">  </span><span class="nt">port-config-json</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">    </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Por</span><span class="nv"> </span><span class="s">config</span><span class="nv"> </span><span class="s">JSON&quot;</span>
<span class="w">  </span><span class="nt">configuration-url</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">    </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://10.0.240.43/server/configuration/&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Server</span><span class="nv"> </span><span class="s">configuration</span><span class="nv"> </span><span class="s">file</span><span class="nv"> </span><span class="s">URL&quot;</span>
</code></pre></div>

<h2>metadata.yaml - relation hierarchy</h2>
<p>This file defines the charm name, and more importantly, its <code>relation</code>
with other charms as in the <code>provides</code> and <code>requires</code> section.</p>
<div class="highlight"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">switch</span>
<span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">This is a switch charm.</span>
<span class="nt">maintainer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Feng Xia &lt;fxia1@lenovo.com&gt;</span>
<span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">  </span><span class="no">A generic switch charm.</span>
<span class="nt">tags</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">switch</span>
<span class="nt">provides</span><span class="p">:</span>
<span class="w">  </span><span class="nt">rack</span><span class="p">:</span>
<span class="w">    </span><span class="nt">interface</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rack-switch</span>
<span class="w">  </span><span class="nt">server</span><span class="p">:</span>
<span class="w">    </span><span class="nt">interface</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">switch-server</span>
</code></pre></div>

<ol>
<li><span class="myhighlight">name</span>: <code>charm build</code> will create a
   folder named <code>switch</code> in <code>JUJU_REPOSITORY/trusty</code> directory. Can
   use <code>$ juju deploy $JUJU_REPOSITORY/trusty/switch</code> to deploy.</li>
<li><span class="myhighlight">tags</span>: arbitrary. Canonical charm
   store has a <a href="https://jujucharms.com/docs/1.24/authors-charm-metadata">list</a> but if we are using these charm local, they become
   irrelevant.</li>
<li><span class="myhighlight">provides/requires</span>: <code>interface:</code>
   must be a valid interface defined in <code>$INTERFACE_PATH</code>. The name
   <code>rack</code> and <code>server</code> can be anything. They will be later be used in
   bundle file (see "Bundle" section).</li>
</ol>
<h2>layer.yaml - charm inheritance</h2>
<p>Each charm is defined as a <code>layer</code> in charm's term. So here one can
<strong>inherit</strong> other charms using <code>includes</code> syntax. </p>
<ol>
<li><code>layer:basic</code> <strong>must</strong> be included! It defines some basic package
   installation, eg. Python binaries and its virtualenv. </li>
<li>Configs from <em>included</em> charms will be pulled into the new charm so
  on Juju GUI all configs defined in both the parent and the children
  are visible.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">git@github.com:xyz/xyz.git</span>
<span class="nt">includes</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;layer:basic&#39;</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;layer:other-charm</span>
</code></pre></div>

<h2>Interface - charm relations</h2>
<p>Charm interface is used in our modeling to define entity-to-entity
relation, such as linking rack to PDU. We have seen how to use these
interfaces in <code>metadata.yaml</code> earlier using <code>requires/provides</code>. In
this section we will see how to define an interface. Using interface
<code>rack-pdu</code> for example:</p>
<div class="highlight"><pre><span></span><code>rack-pdu
├──<span class="w"> </span>interface.yaml
├──<span class="w"> </span>provides.py<span class="w">    </span>&lt;--<span class="w"> </span>code<span class="w"> </span><span class="k">for</span><span class="w"> </span>interface<span class="w"> </span>provider
└──<span class="w"> </span>requires.py<span class="w">    </span>&lt;--<span class="w"> </span>code<span class="w"> </span><span class="k">for</span><span class="w"> </span>interface<span class="w"> </span>consumer
</code></pre></div>

<h2>interface.yaml</h2>
<ol>
<li><span class="myhighlight">name</span>: is the actual interface name
   used in <code>metadata.yaml</code>, not the folder name.</li>
<li>repo: will generate a warning, but no harm.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rack-pdu</span>
<span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Rack to PDU interface</span>
<span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://git.launchpad.net/whatever/</span>
</code></pre></div>

<h1>Deploy charm</h1>
<p>We will cover two ways to deploy charms &mdash; deploy a single charm,
or using a bundle (batch mode). </p>
<p>Setup a sandbox</p>
<ol>
<li>Get a Ubuntu 16.04 VM, install Juju per this <a href="https://jujucharms.com/docs/stable/getting-started">instruction</a>.</li>
<li><code>$ juju bootstrap lxd lxd-test</code> to bootstrap a LXD based juju
   environment.</li>
<li>To run a juju gui, <code>$ juju gui</code>. This should bring up a brower with
   the GUI.<ol>
<li>To login, you need to change the admin password: $ juju
   change-user-password`.</li>
<li>In GUI, username: <code>Admin</code>, password: see previous step.</li>
</ol>
</li>
</ol>
<p>Deploy a single charm. Charm name is the folder name in
<code>$JUJU_REPOSITORY/trusty</code>.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>juju<span class="w"> </span>deploy<span class="w"> </span><span class="nv">$JUJU_REPOSITORY</span>/trusty/<span class="o">[</span>charm<span class="w"> </span>name<span class="o">]</span>

fengxia@local-charmdev:~/juju<span class="w"> </span>deploy<span class="w"> </span><span class="nv">$JUJU_REPOSITORY</span>/trusty/pdu<span class="w"> </span>--series<span class="w"> </span>trusty<span class="w"> </span>--debug
<span class="m">11</span>:13:59<span class="w"> </span>INFO<span class="w">  </span>juju.cmd<span class="w"> </span>supercommand.go:63<span class="w"> </span>running<span class="w"> </span>juju<span class="w"> </span><span class="o">[</span><span class="m">2</span>.0.1.97<span class="w"> </span>gc<span class="w"> </span>go1.6<span class="o">]</span>
<span class="m">11</span>:13:59<span class="w"> </span>DEBUG<span class="w"> </span>juju.cmd<span class="w"> </span>supercommand.go:64<span class="w">   </span>args:<span class="w"> </span><span class="o">[]</span>string<span class="o">{</span><span class="s2">&quot;/home/fengxia/juju&quot;</span>,<span class="w"> </span><span class="s2">&quot;deploy&quot;</span>,<span class="w"> </span><span class="s2">&quot;/home/fengxia/workspace/hwcharm/dist/trusty/pdu&quot;</span>,<span class="w"> </span><span class="s2">&quot;--series&quot;</span>,<span class="w"> </span><span class="s2">&quot;trusty&quot;</span>,<span class="w"> </span><span class="s2">&quot;--debug&quot;</span><span class="o">}</span>
<span class="m">11</span>:13:59<span class="w"> </span>INFO<span class="w">  </span>juju.juju<span class="w"> </span>api.go:72<span class="w"> </span>connecting<span class="w"> </span>to<span class="w"> </span>API<span class="w"> </span>addresses:<span class="w"> </span><span class="o">[</span><span class="m">10</span>.129.186.203:17070<span class="o">]</span>
<span class="m">11</span>:13:59<span class="w"> </span>INFO<span class="w">  </span>juju.api<span class="w"> </span>apiclient.go:530<span class="w"> </span>dialing<span class="w"> </span><span class="s2">&quot;wss://10.129.186.203:17070/model/3b248754-ad0b-40e6-84ca-2b5dedeb98c9/api&quot;</span>
<span class="m">11</span>:13:59<span class="w"> </span>INFO<span class="w">  </span>juju.api<span class="w"> </span>apiclient.go:466<span class="w"> </span>connection<span class="w"> </span>established<span class="w"> </span>to<span class="w"> </span><span class="s2">&quot;wss://10.129.186.203:17070/model/3b248754-ad0b-40e6-84ca-2b5dedeb98c9/api&quot;</span>
<span class="m">11</span>:13:59<span class="w"> </span>DEBUG<span class="w"> </span>juju.juju<span class="w"> </span>api.go:263<span class="w"> </span>API<span class="w"> </span>hostnames<span class="w"> </span>unchanged<span class="w"> </span>-<span class="w"> </span>not<span class="w"> </span>resolving
<span class="m">11</span>:13:59<span class="w"> </span>DEBUG<span class="w"> </span>juju.cmd.juju.application<span class="w"> </span>deploy.go:768<span class="w"> </span>cannot<span class="w"> </span>interpret<span class="w"> </span>as<span class="w"> </span><span class="nb">local</span><span class="w"> </span>bundle:<span class="w"> </span><span class="nb">read</span><span class="w"> </span>/home/fengxia/workspace/hwcharm/dist/trusty/pdu:<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>directory
<span class="m">11</span>:13:59<span class="w"> </span>DEBUG<span class="w"> </span>httpbakery<span class="w"> </span>client.go:244<span class="w"> </span>client<span class="w"> </span><span class="k">do</span><span class="w"> </span>POST<span class="w"> </span>https://10.129.186.203:17070/model/3b248754-ad0b-40e6-84ca-2b5dedeb98c9/charms?revision<span class="o">=</span><span class="m">0</span><span class="p">&amp;</span><span class="nv">schema</span><span class="o">=</span>local<span class="p">&amp;</span><span class="nv">series</span><span class="o">=</span>trusty<span class="w"> </span><span class="o">{</span>
<span class="m">11</span>:14:00<span class="w"> </span>DEBUG<span class="w"> </span>httpbakery<span class="w"> </span>client.go:246<span class="w"> </span><span class="o">}</span><span class="w"> </span>-&gt;<span class="w"> </span>error<span class="w"> </span>&lt;nil&gt;
<span class="m">11</span>:14:00<span class="w"> </span>INFO<span class="w">  </span>cmd<span class="w"> </span>cmd.go:129<span class="w"> </span>Deploying<span class="w"> </span>charm<span class="w"> </span><span class="s2">&quot;local:trusty/pdu-0&quot;</span>.
<span class="m">11</span>:14:00<span class="w"> </span>INFO<span class="w">  </span>cmd<span class="w"> </span>supercommand.go:467<span class="w"> </span><span class="nb">command</span><span class="w"> </span>finished
</code></pre></div>

<h2>bundle</h2>
<p>Charm bundle is a template to batch deploying of multiple charms and
their relations. </p>
<ol>
<li><span class="myhighlight">machines</span>: section to define
  machines that are being requested to run the workload.</li>
<li><span class="myhighlight">services</span>: list of charms to
   deploy.</li>
<li><span class="myhighlight">series</span>: default OS series for a
   new machine.<ol>
<li><code>charm</code>: relative path to charm artifacts</li>
<li><code>num_units</code>: how many charm instances to deploy</li>
<li><code>to</code>: can designate a machine ID for this charm</li>
<li><code>annotations</code>: coordinates for Juju GUI</li>
</ol>
</li>
<li><span class="myhighlight">relations</span>: list of relations to
   connect charms.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="nt">machines</span><span class="p">:</span>
<span class="w">  </span><span class="s">&quot;1&quot;</span><span class="p p-Indicator">:</span>
<span class="w">    </span><span class="nt">constraints</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mem=2G&quot;</span>
<span class="w">    </span><span class="nt">series</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;xenial&quot;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># 42U default rack</span>
<span class="w">  </span><span class="nt">rack</span><span class="p">:</span>
<span class="w">    </span><span class="nt">charm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./dist/trusty/rack</span>
<span class="w">    </span><span class="nt">num_units</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">      </span><span class="nt">gui-x</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;300&quot;</span>
<span class="w">      </span><span class="nt">gui-y</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;300&quot;</span>
<span class="w">    </span><span class="nt">to</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;1&quot;</span>

<span class="c1"># default series, n/a in modeling</span>
<span class="nt">series</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xenial</span>

<span class="c1"># relations</span>
<span class="nt">relations</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># rack to PDU relation</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;rack:pdu&quot;</span><span class="w"> </span><span class="c1"># require first, app name:required interface name</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;pdu:rack&quot;</span><span class="w"> </span><span class="c1"># provide 2nd, app name:provides interface name</span>
</code></pre></div>

<h3>relations</h3>
<p>Definition of <em>relations</em> is confusing at beginning. For software
applications it is less so because <code>provides</code> will offer a service,
eg. http and DB, and <code>requires</code> will consume it.</p>
<p>In HW workload we are borrowing this term to illustrate a rather
general connection between two entities. In the bundle example above,
we first define an interface in <code>$INTERFACE_PATH</code> called
<code>rack-pdu</code>. Then in rack's <code>metadata.yaml</code> we define:</p>
<div class="highlight"><pre><span></span><code><span class="nt">requires</span><span class="p">:</span>
<span class="w">  </span><span class="nt">pdu</span><span class="p">:</span><span class="w">                   </span><span class="l l-Scalar l-Scalar-Plain">&lt;-- can be any name</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">interface</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rack-pdu  &lt;-- must be a valid interface!</span>
</code></pre></div>

<p>and correspondingly in pdu's <code>metadata.yaml</code> we define:</p>
<div class="highlight"><pre><span></span><code><span class="nt">provides</span><span class="p">:</span>
<span class="w">  </span><span class="nt">rack</span><span class="p">:</span><span class="w">                  </span><span class="l l-Scalar l-Scalar-Plain">&lt;-- can be any name</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">interface</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rack-pdu</span>
</code></pre></div>

<p>Then in bundle, we define the followings:</p>
<div class="highlight"><pre><span></span><code><span class="nt">relations</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># rack to PDU relation</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;rack:pdu&quot;</span><span class="w"> </span><span class="c1"># require first, charm name:required interface name</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;pdu:rack&quot;</span><span class="w"> </span><span class="c1"># provide 2nd, charm name:provides interface name</span>
</code></pre></div>

<p>where:
1. first one must be a <code>require</code> relation. Format <code>charm name:interface
   name</code>. Since rack is <em>requiring</em> in this case, the charm name is
   <code>rack</code> (as seen in the <code>Services</code> section), and relation name is
   what's defined in rack's <code>metadata.yaml</code>.
2. Similarly, the second one is the <code>provide</code> relation. Same format
   and naming.</p>
<p>With these set, one can deploy a bundle using <code>$ juju deploy
bundle.yaml</code> and watch the charms get deployed.</p></p>

      <p>
        &mdash; by
        <a href="feng-xia.html">Feng Xia</a>
      </p>
    </div>
  </div>

</article>



          <div id="related">
          </div>
        </div>
      </div>
    </div>

    <footer class="split-screen">
      <div class="container">
        <h5>Categories:</h5>
        <a href="https://fengxia41103.github.io/myblog/demo.html">
          <i class="fa fa-folder-open-o"></i>
          demo
        </a>
        <a href="https://fengxia41103.github.io/myblog/dev.html">
          <i class="fa fa-folder-open-o"></i>
          dev
        </a>
        <a href="https://fengxia41103.github.io/myblog/fashion.html">
          <i class="fa fa-folder-open-o"></i>
          fashion
        </a>
        <a href="https://fengxia41103.github.io/myblog/gkp.html">
          <i class="fa fa-folder-open-o"></i>
          gkp
        </a>
        <a href="https://fengxia41103.github.io/myblog/lenovo.html">
          <i class="fa fa-folder-open-o"></i>
          lenovo
        </a>
        <a href="https://fengxia41103.github.io/myblog/odoo.html">
          <i class="fa fa-folder-open-o"></i>
          odoo
        </a>
        <a href="https://fengxia41103.github.io/myblog/openstack.html">
          <i class="fa fa-folder-open-o"></i>
          openstack
        </a>
        <a href="https://fengxia41103.github.io/myblog/pm.html">
          <i class="fa fa-folder-open-o"></i>
          pm
        </a>
        <a href="https://fengxia41103.github.io/myblog/react.html">
          <i class="fa fa-folder-open-o"></i>
          REACT
        </a>
        <a href="https://fengxia41103.github.io/myblog/rh.html">
          <i class="fa fa-folder-open-o"></i>
          rh
        </a>
        <a href="https://fengxia41103.github.io/myblog/stock.html">
          <i class="fa fa-folder-open-o"></i>
          stock
        </a>
        <a href="https://fengxia41103.github.io/myblog/thoughts.html">
          <i class="fa fa-folder-open-o"></i>
          thoughts
        </a>

        <h5>Tags:</h5>
        <a href="https://fengxia41103.github.io/myblog/tag-thoughts.html">
          <i class="fa fa-tag"></i>
          thoughts
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-dev.html">
          <i class="fa fa-tag"></i>
          dev
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-react.html">
          <i class="fa fa-tag"></i>
          react
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-love.html">
          <i class="fa fa-tag"></i>
          love
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-lenovo.html">
          <i class="fa fa-tag"></i>
          lenovo
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-angular.html">
          <i class="fa fa-tag"></i>
          angular
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-feng.html">
          <i class="fa fa-tag"></i>
          feng
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-design.html">
          <i class="fa fa-tag"></i>
          design
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-family.html">
          <i class="fa fa-tag"></i>
          family
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-demo.html">
          <i class="fa fa-tag"></i>
          demo
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-odoo.html">
          <i class="fa fa-tag"></i>
          odoo
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-fashion.html">
          <i class="fa fa-tag"></i>
          fashion
        </a>
        <a href="https://fengxia41103.github.io/myblog/tag-gkp.html">
          <i class="fa fa-tag"></i>
          gkp
        </a>
        <div class="">
          <h5>Show Cases:</h5>
          <div id="showcase">
            <p>
              Photo album:
              <a href="https://fengxia41103.github.io/moment/1236/#/">1236</a>
            </p>
            <p>
              API & charts:
              <a href="http://sp500chart.s3-website-us-east-1.amazonaws.com"
                >SP500</a
              >
            </p>
            <p>
              API & charts:
              <a
                href="http://snapshots.world.s3-website.ap-northeast-2.amazonaws.com/"
                >Snapshot of The World</a
              >
            </p>

            <p>
              Django (in Chinese):
              <a href="https://fengxia41103.github.io/myblog/project gkp demo.html">GKP</a>
            </p>
            <p>
              ERP:
              <a href="https://fengxia41103.github.io/myblog/project fashion demo.html">Fashion</a>
            </p>
            <p>
              Data processing:
              <a href="https://fengxia41103.github.io/myblog/project stock demo.html">Stock</a>
            </p>
            <p>
              Angular & REACT:
              <a href="https://fengxia41103.github.io/myblog/car leasing.html">Car leasing</a>
              &nbsp;|&nbsp;
              <a href="https://fengxia41103.github.io/spa-dashboard/">
                YAML Config Dashboard
              </a>
            </p>
            <p>
              API & REACT:
              <a href="https://fengxia41103.github.io/movie/">Movies</a>
            </p>
          </div>
        </div>
      </div>
      <video autoplay muted loop id="myVideo">
        <source src="downloads/polina.mp4" type="video/mp4" />
      </video>
    </footer>
    <div class="footer-copyright">
      <div class="container">
        <div class="row">
          <div class="col l8 m8 s12">
            <p>
              2016-2022 PY Consulting Ltd. 601 W. Rosemary St., Chapel Hill, NC 27516
            </p>

            <p>
              <a href="mailto:feng_xia41103@hotmail.com">
                <i class="fa fa-envelope"></i>
              </a>

              <a href="http://github.com/fengxia41103">
                <i class="fa fa-github"></i>
              </a>

              <a href="https://www.linkedin.com/in/fengxia41103">
                <i class="fa fa-linkedin"></i>
              </a>

              <a href="">
                <i class="fa fa-phone-square"></i>
                (508)801-1794
              </a>
            </p>
          </div>
          <div class="col l4 m4 s12">
            <p class="right">
              <i class="fa fa-copyright"></i>
              All rights reserved.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- end of block main -->

    <!-- Placed at the end of the document so the pages load faster -->

    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.1/js/materialize.min.js"
    ></script>

    <script
      type="text/javascript"
      src="https://fengxia41103.github.io/myblog/theme/js/bundle.js"
    ></script>

    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/shell.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"
    ></script>

    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/lisp.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/javascript.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/xml.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/diff.min.js"
    ></script>

    <script type="text/javascript">
     var exports = {};
     var j$ = jQuery.noConflict();

     j$(document).ready(function () {
       // highlight.js initialization
       hljs.initHighlightingOnLoad();
       j$("pre").each(function (i, block) {
         hljs.highlightBlock(block);
       });

       // tooltips
       j$('[data-toggle="tooltip"]').tooltip();

       // image materialbox
       j$(".materialboxed").materialbox();
     });
    </script>
    <!-- end of block JS -->

  </body>
</html>